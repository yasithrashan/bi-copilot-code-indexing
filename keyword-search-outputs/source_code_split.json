{
  "sourceDirectory": "./ballerina",
  "chunks": [
    {
      "id": "108db4ec64649aad",
      "content": "import ballerina/http;"
    },
    {
      "id": "fa1949efbe45d93d",
      "content": "import ballerina/time;"
    },
    {
      "id": "cd76530843b817c4",
      "content": "import ballerina/uuid;"
    },
    {
      "id": "afec4a7626c92edf",
      "content": "configurable int servicePort = 8080;"
    },
    {
      "id": "d1efb944b1469814",
      "content": "configurable string serviceName = \"Bookstore API\";"
    },
    {
      "id": "a987fa32b2f1c30a",
      "content": "configurable int maxBooksPerPage = 10;"
    },
    {
      "id": "d8276481fa6a3188",
      "content": "configurable boolean debugMode = false;"
    },
    {
      "id": "02c8459650906d97",
      "content": "int totalRequests = 0;"
    },
    {
      "id": "8a05ce37340eeff9",
      "content": "map<BookCategory> bookCategories = {};"
    },
    {
      "id": "48d817257c71e19a",
      "content": "map<Book> bookStore = {};"
    },
    {
      "id": "c35d06be35ebb271",
      "content": "string bookId = uuid:createType1AsString();"
    },
    {
      "id": "fcba11265745fe4d",
      "content": "Book validatedBook = {\n        id: bookId,\n        title: bookRequest.title.trim(),\n        author: bookRequest.author.trim(),\n        isbn: bookRequest.isbn.trim(),\n        price: bookRequest.price,\n        quantity: bookRequest.quantity\n    };"
    },
    {
      "id": "29f9a8684e430194",
      "content": "Book[] allBooks = bookStore.toArray();"
    },
    {
      "id": "31006298832df508",
      "content": "int totalCount = allBooks.length();"
    },
    {
      "id": "7a4534bd95f7b4d4",
      "content": "int startIndex = (page - 1) * 'limit;"
    },
    {
      "id": "6af145538d779e1f",
      "content": "int endIndex = startIndex + 'limit;"
    },
    {
      "id": "b085064b48b44dc1",
      "content": "PaginatedBooks emptyResult = {\n                books: [],\n                totalCount: totalCount,\n                currentPage: page,\n                totalPages: (totalCount + 'limit - 1) / 'limit\n            };"
    },
    {
      "id": "46cd1499444bd854",
      "content": "Book[] paginatedBooks = [];"
    },
    {
      "id": "0ab84beed4f24d04",
      "content": "int index = startIndex;"
    },
    {
      "id": "9f35e5bd664da7d4",
      "content": "PaginatedBooks result = {\n            books: paginatedBooks,\n            totalCount: totalCount,\n            currentPage: page,\n            totalPages: (totalCount + 'limit - 1) / 'limit\n        };"
    },
    {
      "id": "fc2e7e4b21fc3ec8",
      "content": "Book book = bookStore.get(k = bookId);"
    },
    {
      "id": "b71ed9d1cfeac8c4",
      "content": "Book|error validatedBook = validateAndFormatBook(bookRequest);"
    },
    {
      "id": "14f7f0f63a6aadad",
      "content": "Book updatedBook = {\n            id: bookId,\n            title: bookRequest.title,\n            author: bookRequest.author,\n            isbn: bookRequest.isbn,\n            price: bookRequest.price,\n            quantity: bookRequest.quantity\n        };"
    },
    {
      "id": "bf62c5ab5502e978",
      "content": "Book removedBook = bookStore.remove(k = bookId);"
    },
    {
      "id": "8778a8b09f5e5b70",
      "content": "Book[] filteredBooks = [];"
    },
    {
      "id": "0f5ecc4364c780f7",
      "content": "boolean matches = true;"
    },
    {
      "id": "14dec96347bd1033",
      "content": "ServiceStats stats = {\n            totalRequests: totalRequests,\n            totalBooks: bookStore.length(),\n            serviceStartTime: startTimeString,\n            serviceName: serviceName,\n            debugMode: debugMode\n        };"
    },
    {
      "id": "6b2159a447de8988",
      "content": "function validateAndFormatBook(BookRequest bookRequest) returns Book|error {\n    if bookRequest.title.trim().length() == 0 {\n        return error(\"Book title cannot be empty\");\n    }\n\n    if bookRequest.author.trim().length() == 0 {\n        return error(\"Book author cannot be empty\");\n    }\n\n    if bookRequest.price < 0.0d {\n        return error(\"Book price cannot be negative\");\n    }\n\n    if bookRequest.quantity < 0 {\n        return error(\"Book quantity cannot be negative\");\n    }\n\n    string bookId = uuid:createType1AsString();\n\n    Book validatedBook = {\n        id: bookId,\n        title: bookRequest.title.trim(),\n        author: bookRequest.author.trim(),\n        isbn: bookRequest.isbn.trim(),\n        price: bookRequest.price,\n        quantity: bookRequest.quantity\n    };\n\n    return validatedBook;\n}"
    },
    {
      "id": "cb314be4490edd84",
      "content": "service /bookstore on new http:Listener(servicePort) {"
    },
    {
      "id": "327ac08ac6d21f00",
      "content": "resource function get books(int page = 1, int 'limit = maxBooksPerPage) returns PaginatedBooks|http:InternalServerError {\n        totalRequests += 1;\n\n        Book[] allBooks = bookStore.toArray();\n        int totalCount = allBooks.length();\n        int startIndex = (page - 1) * 'limit;\n        int endIndex = startIndex + 'limit;\n\n        if startIndex >= totalCount {\n            PaginatedBooks emptyResult = {\n                books: [],\n                totalCount: totalCount,\n                currentPage: page,\n                totalPages: (totalCount + 'limit - 1) / 'limit\n            };\n            return emptyResult;\n        }\n\n        if endIndex > totalCount {\n            endIndex = totalCount;\n        }\n\n        Book[] paginatedBooks = [];\n        int index = startIndex;\n        while index < endIndex {\n            paginatedBooks.push(allBooks[index]);\n            index += 1;\n        }\n\n        PaginatedBooks result = {\n            books: paginatedBooks,\n            totalCount: totalCount,\n            currentPage: page,\n            totalPages: (totalCount + 'limit - 1) / 'limit\n        };\n\n        return result;\n    }"
    },
    {
      "id": "9bb53b6dfe6fd8f6",
      "content": "resource function post books(@http:Payload BookRequest bookRequest) returns http:Created|http:BadRequest|http:InternalServerError {\n        totalRequests += 1;\n\n        Book|error validatedBook = validateAndFormatBook(bookRequest);\n        if validatedBook is error {\n            return http:BAD_REQUEST;\n        }\n\n        bookStore[validatedBook.id] = validatedBook;\n        return http:CREATED;\n    }"
    },
    {
      "id": "7bea3c31c37d9129",
      "content": "resource function post books/search(@http:Payload BookSearchCriteria searchCriteria) returns Book[]|http:InternalServerError {\n        totalRequests += 1;\n\n        Book[] allBooks = bookStore.toArray();\n        Book[] filteredBooks = [];\n\n        foreach Book book in allBooks {\n            boolean matches = true;\n\n            string? titleCriteria = searchCriteria.title;\n            if titleCriteria is string {\n                if !book.title.toLowerAscii().includes(titleCriteria.toLowerAscii()) {\n                    matches = false;\n                }\n            }\n\n            string? authorCriteria = searchCriteria.author;\n            if authorCriteria is string && matches {\n                if !book.author.toLowerAscii().includes(authorCriteria.toLowerAscii()) {\n                    matches = false;\n                }\n            }\n\n            string? isbnCriteria = searchCriteria.isbn;\n            if isbnCriteria is string && matches {\n                if !book.isbn.includes(isbnCriteria) {\n                    matches = false;\n                }\n            }\n\n            decimal? minPriceCriteria = searchCriteria.minPrice;\n            if minPriceCriteria is decimal && matches {\n                if book.price < minPriceCriteria {\n                    matches = false;\n                }\n            }\n\n            decimal? maxPriceCriteria = searchCriteria.maxPrice;\n            if maxPriceCriteria is decimal && matches {\n                if book.price > maxPriceCriteria {\n                    matches = false;\n                }\n            }\n\n            if matches {\n                filteredBooks.push(book);\n            }\n        }\n\n        return filteredBooks;\n    }"
    },
    {
      "id": "8a6ed9c6bc9b8dbb",
      "content": "resource function get health() returns map<string> {\n        totalRequests += 1;\n        return {\"status\": \"UP\", \"service\": serviceName};\n    }"
    },
    {
      "id": "bfef2311d087c6bd",
      "content": "service /admin on new http:Listener(servicePort) {"
    },
    {
      "id": "87e4d9ecbec42553",
      "content": "resource function get stats() returns ServiceStats {\n        totalRequests += 1;\n\n        string startTimeString = time:utcToString(serviceStartTime);\n\n        ServiceStats stats = {\n            totalRequests: totalRequests,\n            totalBooks: bookStore.length(),\n            serviceStartTime: startTimeString,\n            serviceName: serviceName,\n            debugMode: debugMode\n        };\n\n        return stats;\n    }"
    },
    {
      "id": "d5a7e3df8b825d89",
      "content": "resource function post categories(@http:Payload BookCategory category) returns http:Created|http:BadRequest {\n        totalRequests += 1;\n\n        if category.categoryName.trim().length() == 0 {\n            return http:BAD_REQUEST;\n        }\n\n        bookCategories[category.categoryId] = category;\n        return http:CREATED;\n    }"
    },
    {
      "id": "af69403df96dd57a",
      "content": "resource function get categories() returns BookCategory[] {\n        totalRequests += 1;\n        return bookCategories.toArray();\n    }"
    },
    {
      "id": "4cde4dab6225a3c4",
      "content": "type\npublic type Book record {|\n    string id;"
    },
    {
      "id": "036289af88120abf",
      "content": "public type BookRequest record {|\n    string title;\n    string author;\n    string isbn;\n    decimal price;\n    int quantity;\n|};"
    },
    {
      "id": "94e5366138ccf57e",
      "content": "type\npublic type ErrorResponse record {|\n    string message;"
    },
    {
      "id": "ed40781d3f840e26",
      "content": "type\npublic type PaginatedBooks record {|\n    Book[] books;"
    },
    {
      "id": "c9ba665cc1c15c10",
      "content": "type\npublic type BookSearchCriteria record {|\n    string? title;"
    },
    {
      "id": "a48a913ca6ad283e",
      "content": "type\npublic type ServiceStats record {|\n    int totalRequests;"
    },
    {
      "id": "5053e6cd51a9274e",
      "content": "type\npublic type BookCategory record {|\n    string categoryId;"
    }
  ]
}