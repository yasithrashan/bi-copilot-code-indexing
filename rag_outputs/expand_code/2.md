# Ballerina Code Expansion

**Query:** Modify the PUT /books/{bookId} endpoint to reuse the validation logic (validateAndFormatBook) so updates also check for empty titles, negative prices, etc.

---

## Filename: main.bal

Imports
```ballerina
import ballerina/http;
import ballerina/time;
import ballerina/uuid;
```

Configuration Variables
```ballerina
configurable int servicePort = 8080;
configurable string serviceName = "Bookstore API";
configurable int maxBooksPerPage = 10;
configurable boolean debugMode = false;
```

Module Level Variables
```ballerina
int totalRequests = 0;
time:Utc serviceStartTime = time:utcNow();
map<BookCategory> bookCategories = {};
map<Book> bookStore = {};
```

Services
```ballerina
service /bookstore on new http:Listener(servicePort) {
```

Resources
```ballerina
resource function put books/[string bookId](@http:Payload BookRequest bookRequest) returns Book|http:NotFound|http:BadRequest|http:InternalServerError {
    totalRequests += 1;

    if !bookStore.hasKey(k = bookId) {
        return http:NOT_FOUND;
    }

    Book|error validatedBook = validateAndFormatBook(bookRequest);
    if validatedBook is error {
        return http:BAD_REQUEST;
    }

    Book updatedBook = {
        id: bookId,
        title: validatedBook.title,
        author: validatedBook.author,
        isbn: validatedBook.isbn,
        price: validatedBook.price,
        quantity: validatedBook.quantity
    };

    bookStore[bookId] = updatedBook;
    return updatedBook;
}
```

Matching Resources
```ballerina
function validateAndFormatBook(BookRequest bookRequest) returns Book|error {
    if bookRequest.title.trim().length() == 0 {
        return error("Book title cannot be empty");
    }

    if bookRequest.author.trim().length() == 0 {
        return error("Book author cannot be empty");
    }

    if bookRequest.price < 0.0d {
        return error("Book price cannot be negative");
    }

    if bookRequest.quantity < 0 {
        return error("Book quantity cannot be negative");
    }

    string bookId = uuid:createType1AsString();

    Book validatedBook = {
        id: bookId,
        title: bookRequest.title.trim(),
        author: bookRequest.author.trim(),
        isbn: bookRequest.isbn.trim(),
        price: bookRequest.price,
        quantity: bookRequest.quantity
    };

    return validatedBook;
}
```

## Filename: types.bal

```ballerina
public type Book record {|
    string id;
    string title;
    string author;
    string isbn;
    decimal price;
    int quantity;
|};

public type BookRequest record {|
    string title;
    string author;
    string isbn;
    decimal price;
    int quantity;
|};
```

---

*Code expansion generated from 8 relevant chunks across 2 files*
