# Code Extract Report

**Query ID:** 5
**Search criteria:** Code segments related to error responses and error handling in the API endpoints
**Files processed:** 2

---

File: types.bal
```ballerina
// Error response type
public type ErrorResponse record {|
    string message;
|};
```

File: main.bal
```ballerina
// Get a specific book by ID
resource function get books/[string bookId]() returns Book|http:NotFound|http:InternalServerError {
    totalRequests += 1;

    if bookStore.hasKey(k = bookId) {
        Book book = bookStore.get(k = bookId);
        return book;
    }
    return http:NOT_FOUND;
}

// Add a new book
resource function post books(@http:Payload BookRequest bookRequest) returns http:Created|http:BadRequest|http:InternalServerError {
    totalRequests += 1;

    Book|error validatedBook = validateAndFormatBook(bookRequest);
    if validatedBook is error {
        return http:BAD_REQUEST;
    }

    bookStore[validatedBook.id] = validatedBook;
    return http:CREATED;
}

// Utility function showing error handling
function validateAndFormatBook(BookRequest bookRequest) returns Book|error {
    if bookRequest.title.trim().length() == 0 {
        return error("Book title cannot be empty");
    }

    if bookRequest.author.trim().length() == 0 {
        return error("Book author cannot be empty");
    }

    if bookRequest.price < 0.0d {
        return error("Book price cannot be negative");
    }

    if bookRequest.quantity < 0 {
        return error("Book quantity cannot be negative");
    }
    // ... rest of the function
}
```