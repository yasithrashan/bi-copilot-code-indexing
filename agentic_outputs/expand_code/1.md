# Code Extract Report

**Query ID:** 1
**Search criteria:** Pagination logic in GET /books endpoint, including parameter validation
**Files processed:** 2

---

File: main.bal

// Get all books with pagination
resource function get books(int page = 1, int 'limit = maxBooksPerPage) returns PaginatedBooks|http:InternalServerError {
    totalRequests += 1;

    Book[] allBooks = bookStore.toArray();
    int totalCount = allBooks.length();
    int startIndex = (page - 1) * 'limit;
    int endIndex = startIndex + 'limit;

    if startIndex >= totalCount {
        PaginatedBooks emptyResult = {
            books: [],
            totalCount: totalCount,
            currentPage: page,
            totalPages: (totalCount + 'limit - 1) / 'limit
        };
        return emptyResult;
    }

    if endIndex > totalCount {
        endIndex = totalCount;
    }

    Book[] paginatedBooks = [];
    int index = startIndex;
    while index < endIndex {
        paginatedBooks.push(allBooks[index]);
        index += 1;
    }

    PaginatedBooks result = {
        books: paginatedBooks,
        totalCount: totalCount,
        currentPage: page,
        totalPages: (totalCount + 'limit - 1) / 'limit
    };

    return result;
}

File: types.bal

// Pagination response type
public type PaginatedBooks record {|
    Book[] books;
    int totalCount;
    int currentPage;
    int totalPages;
|};