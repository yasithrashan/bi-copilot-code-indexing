# Ballerina Code Expansion

**Query:** Modify the PUT /books/{bookId} endpoint to reuse the validation logic (validateAndFormatBook) so updates also check for empty titles, negative prices, etc.

---

Based on the user query and the relevant code chunks provided, I'll expand and organize the existing code to show how the PUT /books/{bookId} endpoint can be modified to reuse the validation logic. Here's the relevant code:

## Filename: main.bal

## Imports
```ballerina
import ballerina/http;
import ballerina/uuid;
```

## Module Level Variables
```ballerina
map<Book> bookStore = {};
```

## Services
```ballerina
service /bookstore on new http:Listener(servicePort) {
    // ... other resources ...

    // Update an existing book
    resource function put books/[string bookId](@http:Payload BookRequest bookRequest) returns Book|http:NotFound|http:BadRequest|http:InternalServerError {
        totalRequests += 1;

        if !bookStore.hasKey(k = bookId) {
            return http:NOT_FOUND;
        }

        Book|error validatedBook = validateAndFormatBook(bookRequest);
        if validatedBook is error {
            return http:BAD_REQUEST;
        }

        validatedBook.id = bookId;
        bookStore[bookId] = validatedBook;
        return validatedBook;
    }

    // ... other resources ...
}
```

## Resources
```ballerina
function validateAndFormatBook(BookRequest bookRequest) returns Book|error {
    if bookRequest.title.trim().length() == 0 {
        return error("Book title cannot be empty");
    }

    if bookRequest.author.trim().length() == 0 {
        return error("Book author cannot be empty");
    }

    if bookRequest.price < 0.0d {
        return error("Book price cannot be negative");
    }

    if bookRequest.quantity < 0 {
        return error("Book quantity cannot be negative");
    }

    string bookId = uuid:createType1AsString();

    Book validatedBook = {
        id: bookId,
        title: bookRequest.title.trim(),
        author: bookRequest.author.trim(),
        isbn: bookRequest.isbn.trim(),
        price: bookRequest.price,
        quantity: bookRequest.quantity
    };

    return validatedBook;
}
```

This expanded code shows how the PUT /books/{bookId} endpoint can be modified to reuse the validateAndFormatBook function for validation. The main changes are:

1. We now call validateAndFormatBook with the incoming bookRequest.
2. We check if the result is an error, and if so, we return a BAD_REQUEST response.
3. If validation passes, we use the validated book data, only overriding the id with the existing bookId.
4. We then update the bookStore with the validated and formatted book data.

This approach ensures that updates also check for empty titles, negative prices, and other validation rules defined in the validateAndFormatBook function.

---
