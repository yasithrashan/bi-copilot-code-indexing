# Ballerina Code Expansion

**Query:** Extend the category service to also support update and delete operations for categories.

---

Based on the user query and the relevant code chunks provided, I'll expand and organize the existing code to include update and delete operations for categories. Here's the expanded and organized code:

## Filename: main.bal

## Imports
```ballerina
import ballerina/http;
import ballerina/time;
import ballerina/uuid;
```

## Configuration Variables
```ballerina
configurable int servicePort = 8080;
configurable string serviceName = "Bookstore API";
```

## Module Level Variables
```ballerina
int totalRequests = 0;
time:Utc serviceStartTime = time:utcNow();
map<BookCategory> bookCategories = {};
```

## Services
```ballerina
service /admin on new http:Listener(servicePort) {
    // Existing resources
    resource function get stats() returns ServiceStats {
        // ... (existing code)
    }

    resource function post categories(@http:Payload BookCategory category) returns http:Created|http:BadRequest {
        totalRequests += 1;

        if category.categoryName.trim().length() == 0 {
            return http:BAD_REQUEST;
        }

        bookCategories[category.categoryId] = category;
        return http:CREATED;
    }

    resource function get categories() returns BookCategory[] {
        totalRequests += 1;
        return bookCategories.toArray();
    }

    // New resources for update and delete operations
    resource function put categories/[string categoryId](@http:Payload BookCategory updatedCategory) returns http:Ok|http:NotFound|http:BadRequest {
        totalRequests += 1;

        if !bookCategories.hasKey(categoryId) {
            return http:NOT_FOUND;
        }

        if updatedCategory.categoryName.trim().length() == 0 {
            return http:BAD_REQUEST;
        }

        bookCategories[categoryId] = updatedCategory;
        return http:OK;
    }

    resource function delete categories/[string categoryId]() returns http:NoContent|http:NotFound {
        totalRequests += 1;

        if !bookCategories.hasKey(categoryId) {
            return http:NOT_FOUND;
        }

        _ = bookCategories.remove(categoryId);
        return http:NO_CONTENT;
    }
}
```

## Resources
```ballerina
resource function post categories(@http:Payload BookCategory category) returns http:Created|http:BadRequest {
    totalRequests += 1;

    if category.categoryName.trim().length() == 0 {
        return http:BAD_REQUEST;
    }

    bookCategories[category.categoryId] = category;
    return http:CREATED;
}

resource function get categories() returns BookCategory[] {
    totalRequests += 1;
    return bookCategories.toArray();
}

resource function put categories/[string categoryId](@http:Payload BookCategory updatedCategory) returns http:Ok|http:NotFound|http:BadRequest {
    totalRequests += 1;

    if !bookCategories.hasKey(categoryId) {
        return http:NOT_FOUND;
    }

    if updatedCategory.categoryName.trim().length() == 0 {
        return http:BAD_REQUEST;
    }

    bookCategories[categoryId] = updatedCategory;
    return http:OK;
}

resource function delete categories/[string categoryId]() returns http:NoContent|http:NotFound {
    totalRequests += 1;

    if !bookCategories.hasKey(categoryId) {
        return http:NOT_FOUND;
    }

    _ = bookCategories.remove(categoryId);
    return http:NO_CONTENT;
}
```

## Matching Resources
```ballerina
resource function get health() returns map<string> {
    totalRequests += 1;
    return {"status": "UP", "service": serviceName};
}
```

This expanded code includes the existing category-related resources and adds new resources for updating and deleting categories. The update operation (`put categories/[string categoryId]`) allows modifying an existing category, while the delete operation (`delete categories/[string categoryId]`) removes a category from the `bookCategories` map. Both new operations include appropriate error handling for cases where the category is not found or the input is invalid.

---
