# Ballerina Code Expansion

**Query:** Add a new HTTP server to the current implementation.

---

To address the query "Add a new HTTP server to the current implementation," I'll expand and organize the relevant existing code from the source files. The code already contains two HTTP servers: `/bookstore` and `/admin`. I'll present the relevant code for these existing servers and show where a new server could be added.

## Filename: main.bal

## Imports
```ballerina
import ballerina/http;
import ballerina/time;
import ballerina/uuid;
```

## Configuration Variables
```ballerina
configurable int servicePort = 8080;
configurable string serviceName = "Bookstore API";
configurable int maxBooksPerPage = 10;
configurable boolean debugMode = false;
```

## Module Level Variables
```ballerina
int totalRequests = 0;
time:Utc serviceStartTime = time:utcNow();
map<BookCategory> bookCategories = {};
map<Book> bookStore = {};
```

## Services
```ballerina
// Existing HTTP server for bookstore
service /bookstore on new http:Listener(servicePort) {
    // Resources will be listed in the Resources section
}

// Existing HTTP server for admin
service /admin on new http:Listener(servicePort) {
    // Resources will be listed in the Resources section
}

// New HTTP server can be added here
// For example:
// service /newservice on new http:Listener(8081) {
//     // Add new resources here
// }
```

## Resources
```ballerina
// Resources for /bookstore service
resource function get books(int page = 1, int 'limit = maxBooksPerPage) returns PaginatedBooks|http:InternalServerError {
    // Implementation details omitted for brevity
}

resource function get books/[string bookId]() returns Book|http:NotFound|http:InternalServerError {
    // Implementation details omitted for brevity
}

resource function post books(@http:Payload BookRequest bookRequest) returns http:Created|http:BadRequest|http:InternalServerError {
    totalRequests += 1;

    Book|error validatedBook = validateAndFormatBook(bookRequest);
    if validatedBook is error {
        return http:BAD_REQUEST;
    }

    bookStore[validatedBook.id] = validatedBook;
    return http:CREATED;
}

resource function put books/[string bookId](@http:Payload BookRequest bookRequest) returns Book|http:NotFound|http:BadRequest|http:InternalServerError {
    // Implementation details omitted for brevity
}

resource function delete books/[string bookId]() returns http:NoContent|http:NotFound|http:InternalServerError {
    // Implementation details omitted for brevity
}

resource function post books/search(@http:Payload BookSearchCriteria searchCriteria) returns Book[]|http:InternalServerError {
    // Implementation details omitted for brevity
}

resource function get health() returns map<string> {
    totalRequests += 1;
    return {"status": "UP", "service": serviceName};
}

// Resources for /admin service
resource function get stats() returns ServiceStats {
    // Implementation details omitted for brevity
}

resource function post categories(@http:Payload BookCategory category) returns http:Created|http:BadRequest {
    totalRequests += 1;

    if category.categoryName.trim().length() == 0 {
        return http:BAD_REQUEST;
    }

    bookCategories[category.categoryId] = category;
    return http:CREATED;
}

resource function get categories() returns BookCategory[] {
    totalRequests += 1;
    return bookCategories.toArray();
}
```

## Matching Resources
To add a new HTTP server to the current implementation, you can follow the pattern of the existing services. Here's an example of how you might start a new service:

```ballerina
// New HTTP server
service /newservice on new http:Listener(8081) {
    resource function get hello() returns string {
        return "Hello from the new service!";
    }

    // Add more resources as needed
}
```

This new service would run on port 8081 (or any other available port) and can include additional resources and functionality as required. Remember to add any necessary imports, configuration variables, or module-level variables to support the new service.

---
