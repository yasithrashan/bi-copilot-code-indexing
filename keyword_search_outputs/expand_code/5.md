# Ballerina Code Expansion

**Query:** Standardize the error responses so they always return a JSON object with an error message (e.g., { \"error\": \"Book not found\" }) instead of just plain HTTP status codes.

---

Based on the user query and the relevant code chunks provided, I'll expand and organize the existing code to show how we can standardize error responses. We'll focus on the `main.bal` file, as it contains the relevant service and resource functions.

## Filename: main.bal

## Imports

```ballerina
import ballerina/http;
import ballerina/time;
import ballerina/uuid;
```

## Configuration Variables

```ballerina
configurable int servicePort = 8080;
configurable string serviceName = "Bookstore API";
configurable int maxBooksPerPage = 10;
configurable boolean debugMode = false;
```

## Module Level Variables

```ballerina
int totalRequests = 0;
time:Utc serviceStartTime = time:utcNow();
map<BookCategory> bookCategories = {};
map<Book> bookStore = {};
```

## Services

```ballerina
service /bookstore on new http:Listener(servicePort) {
    // Existing resource functions will be expanded below
}
```

## Resources

```ballerina
resource function get books/[string bookId]() returns Book|ErrorResponse|http:InternalServerError {
    totalRequests += 1;

    if bookStore.hasKey(k = bookId) {
        Book book = bookStore.get(k = bookId);
        return book;
    }
    return { error: "Book not found" };
}

resource function post books(@http:Payload BookRequest bookRequest) returns http:Created|ErrorResponse|http:InternalServerError {
    totalRequests += 1;

    Book|error validatedBook = validateAndFormatBook(bookRequest);
    if validatedBook is error {
        return { error: validatedBook.message() };
    }

    bookStore[validatedBook.id] = validatedBook;
    return http:CREATED;
}

resource function put books/[string bookId](@http:Payload BookRequest bookRequest) returns Book|ErrorResponse|http:InternalServerError {
    totalRequests += 1;

    if !bookStore.hasKey(k = bookId) {
        return { error: "Book not found" };
    }

    Book updatedBook = {
        id: bookId,
        title: bookRequest.title,
        author: bookRequest.author,
        isbn: bookRequest.isbn,
        price: bookRequest.price,
        quantity: bookRequest.quantity
    };

    bookStore[bookId] = updatedBook;
    return updatedBook;
}

resource function delete books/[string bookId]() returns http:NoContent|ErrorResponse|http:InternalServerError {
    totalRequests += 1;

    if !bookStore.hasKey(k = bookId) {
        return { error: "Book not found" };
    }

    Book removedBook = bookStore.remove(k = bookId);
    return http:NO_CONTENT;
}
```

## Matching Resources

```ballerina
resource function get health() returns map<string> {
    totalRequests += 1;
    return {"status": "UP", "service": serviceName};
}

resource function post categories(@http:Payload BookCategory category) returns http:Created|ErrorResponse {
    totalRequests += 1;

    if category.categoryName.trim().length() == 0 {
        return { error: "Category name cannot be empty" };
    }

    bookCategories[category.categoryId] = category;
    return http:CREATED;
}
```

To complement the changes in the resources, we need to update the type definitions. Here's the relevant part from the `types.bal` file:

## Filename: types.bal

```ballerina
// Error response type
public type ErrorResponse record {|
    string error;
|};
```

Note that we've made the following changes to standardize error responses:

1. Updated return types in resource functions to include `ErrorResponse` instead of `http:NotFound` or `http:BadRequest`.
2. Replaced `http:NOT_FOUND` and `http:BAD_REQUEST` responses with `ErrorResponse` records containing appropriate error messages.
3. Updated the `ErrorResponse` type in `types.bal` to match the new format.

These changes ensure that all error responses are returned as JSON objects with an error message, as requested in the user query.

---
