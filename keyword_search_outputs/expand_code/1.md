# Ballerina Code Expansion

**Query:** Update the pagination logic so it validates 'page' and 'limit' values, returning a 400 Bad Request if they are less than or equal to zero

---

Based on the user query and the relevant code chunks, I'll expand and organize the existing code to show how the pagination logic could be updated to validate 'page' and 'limit' values. Here's the relevant code with the necessary context:

## Filename: main.bal

## Imports
```ballerina
import ballerina/http;
```

## Configuration Variables
```ballerina
configurable int maxBooksPerPage = 10;
```

## Module Level Variables
```ballerina
int totalRequests = 0;
map<Book> bookStore = {};
```

## Services
```ballerina
service /bookstore on new http:Listener(servicePort) {
    // Other resources...

    resource function get books(int page = 1, int 'limit = maxBooksPerPage) returns PaginatedBooks|http:BadRequest|http:InternalServerError {
        totalRequests += 1;

        // Validate page and limit values
        if (page <= 0 || 'limit <= 0) {
            return http:BAD_REQUEST;
        }

        Book[] allBooks = bookStore.toArray();
        int totalCount = allBooks.length();
        int startIndex = (page - 1) * 'limit;
        int endIndex = startIndex + 'limit;

        if startIndex >= totalCount {
            PaginatedBooks emptyResult = {
                books: [],
                totalCount: totalCount,
                currentPage: page,
                totalPages: (totalCount + 'limit - 1) / 'limit
            };
            return emptyResult;
        }

        if endIndex > totalCount {
            endIndex = totalCount;
        }

        Book[] paginatedBooks = [];
        int index = startIndex;
        while index < endIndex {
            paginatedBooks.push(allBooks[index]);
            index += 1;
        }

        PaginatedBooks result = {
            books: paginatedBooks,
            totalCount: totalCount,
            currentPage: page,
            totalPages: (totalCount + 'limit - 1) / 'limit
        };

        return result;
    }

    // Other resources...
}
```

## Filename: types.bal

## Imports
```ballerina
import ballerina/http;
```

## Types
```ballerina
public type Book record {|
    string id;
    string title;
    string author;
    string isbn;
    decimal price;
    int quantity;
|};

public type PaginatedBooks record {|
    Book[] books;
    int totalCount;
    int currentPage;
    int totalPages;
|};
```

This expanded code shows the relevant parts of the `main.bal` and `types.bal` files, focusing on the pagination logic in the `get books` resource function. The main changes are:

1. The return type of the resource function now includes `http:BadRequest`.
2. A validation check for `page` and `limit` values has been added at the beginning of the function.
3. If either `page` or `limit` is less than or equal to zero, the function returns `http:BAD_REQUEST`.

The rest of the pagination logic remains the same, but now it will only be executed if the input values are valid. This update addresses the user's request to validate the pagination parameters and return a 400 Bad Request for invalid values.

---
