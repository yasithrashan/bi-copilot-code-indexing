# Ballerina Code Expansion

**Query:** Update the pagination logic so it validates 'page' and 'limit' values, returning a 400 Bad Request if they are less than or equal to zero

---

Based on the user query and the relevant code chunks, I'll expand and organize the existing code to show how the pagination logic can be updated to validate 'page' and 'limit' values. Here's the expanded and organized code:

## Filename: main.bal

## Imports
```ballerina
import ballerina/http;
```

## Configuration Variables
```ballerina
configurable int maxBooksPerPage = 10;
```

## Module Level Variables
```ballerina
int totalRequests = 0;
map<Book> bookStore = {};
```

## Services
```ballerina
service /bookstore on new http:Listener(servicePort) {
    // Other resources...

    resource function get books(int page = 1, int 'limit = maxBooksPerPage) returns PaginatedBooks|http:BadRequest|http:InternalServerError {
        totalRequests += 1;

        // Validate page and limit values
        if (page <= 0 || 'limit <= 0) {
            return http:BAD_REQUEST;
        }

        Book[] allBooks = bookStore.toArray();
        int totalCount = allBooks.length();
        int startIndex = (page - 1) * 'limit;
        int endIndex = startIndex + 'limit;

        if startIndex >= totalCount {
            PaginatedBooks emptyResult = {
                books: [],
                totalCount: totalCount,
                currentPage: page,
                totalPages: (totalCount + 'limit - 1) / 'limit
            };
            return emptyResult;
        }

        if endIndex > totalCount {
            endIndex = totalCount;
        }

        Book[] paginatedBooks = [];
        int index = startIndex;
        while index < endIndex {
            paginatedBooks.push(allBooks[index]);
            index += 1;
        }

        PaginatedBooks result = {
            books: paginatedBooks,
            totalCount: totalCount,
            currentPage: page,
            totalPages: (totalCount + 'limit - 1) / 'limit
        };

        return result;
    }

    // Other resources...
}
```

## Filename: types.bal

## Imports
```ballerina
import ballerina/http;
```

## Configuration Variables
```ballerina
// No relevant configuration variables in this file
```

## Module Level Variables
```ballerina
// No relevant module level variables in this file
```

## Services
```ballerina
// No relevant services in this file
```

## Resources
```ballerina
// No relevant resources in this file
```

## Matching Resources
```ballerina
// Book record type
public type Book record {|
    string id;
    string title;
    string author;
    string isbn;
    decimal price;
    int quantity;
|};

// Pagination response type
public type PaginatedBooks record {|
    Book[] books;
    int totalCount;
    int currentPage;
    int totalPages;
|};
```

This expanded code shows the updated pagination logic in the `get books` resource function. The function now validates the `page` and `limit` values, returning a `http:BAD_REQUEST` if either of them is less than or equal to zero. The rest of the pagination logic remains the same as in the original code.

The relevant types (`Book` and `PaginatedBooks`) are included from the `types.bal` file to provide context for the data structures used in the pagination logic.

---
